<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Transcendence</title>
	<style>
		canvas {
			background-color: black;
			padding: 0;
		}
	</style>
</head>

<body>
	<canvas id="canvas" width="800" height="400"></canvas>
	<script>
		const ctx = canvas.getContext("2d"); // pull componet of canvas

		// default position of pong
		const ball = {
			x: canvas.width / 2,
			y: canvas.height / 2,
			radius: 10,
			speed: 4,
			dx: 2, // speed x
			dy: 2, // speed y
			color: "WHITE",
		};

		// default position of user
		const userPaddle = {
			x: 0,
			y: canvas.height / 2 - 40,
			width: 10,
			height: 80,
			dy: 4,
			color: "WHITE",
		};

		// default position of computer
		const compPaddle = {
			x: canvas.width - 10,
			y: canvas.height / 2 - 40,
			width: 10,
			height: 80,
			dy: 4,
			color: "WHITE",
		};

		function drawRect(x, y, width, height, color) {
			ctx.fillStyle = color;
			ctx.fillRect(x, y, width, height);
		}

		function drawCircle(x, y, radius, color) {
			ctx.fillStyle = color;
			ctx.beginPath();
			ctx.arc(x, y, radius, 0, Math.PI * 2, false);
			ctx.closePath();
			ctx.fill();
		}

		function draw() {
			// erases the pixels in regular area (0, 0) to canvas (width, height)
			ctx.clearRect(0, 0, canvas.width, canvas.height)
			drawRect(
				userPaddle.x,
				userPaddle.y,
				userPaddle.width,
				userPaddle.height,
				userPaddle.color
			);

			drawRect(
				compPaddle.x,
				compPaddle.y,
				compPaddle.width,
				compPaddle.height,
				compPaddle.color
			);

			drawCircle(
				ball.x,
				ball.y,
				ball.radius,
				ball.color
			);
		}

		function move() {
			ball.x += ball.dx;
			ball.y += ball.dy;

			if ((ball.y + ball.radius > canvas.height) || (ball.y - ball.radius < 0)) {
				ball.dy = -ball.dy;
			}

			if (ball.x + ball.radius > canvas.width) {

				if (ball.y >= compPaddle.y && ball.y <= compPaddle.y + compPaddle.height) {
					ball.dx = -ball.dx;
					if (ball.dx > 0)
						ball.dx += 0.3;
					else
						ball.dx -= 0.3;
					if (ball.dy > 0)
						ball.dy += 0.3;
					else
						ball.dy -= 0.3;
				}
				else {
					ball.x = canvas.width / 2
					ball.y = canvas.height / 2
					ball.dx = -ball.dx;
					ball.dx = 3;
					ball.dy = 3;
				}
			}

			if (ball.x - ball.radius < 0) {
				if (ball.y >= userPaddle.y && ball.y <= userPaddle.y + userPaddle.height) {
					ball.dx = -ball.dx;
					if (ball.dx > 0)
						ball.dx += 0.3;
					else
						ball.dx -= 0.3;
					if (ball.dy > 0)
						ball.dy += 0.3;
					else
						ball.dy -= 0.3;
				}
				else {
					ball.x = canvas.width / 2
					ball.y = canvas.height / 2
					ball.dx = -ball.dx;
					ball.dx = 2;
					ball.dy = 2;
				}
			}

			// random pc paddle
			compPaddle.y += (ball.y - (compPaddle.y + compPaddle.height / 2)) * 0.8;
			console.log(ball.dx, ball.dy)
		}
		const keys = {}; // Object to store key states

		// Event listeners for keydown and keyup
		document.addEventListener("keydown", (event) => {
			keys[event.key] = true; // Mark the key as pressed
		});

		document.addEventListener("keyup", (event) => {
			keys[event.key] = false; // Mark the key as released
		});

		function movePaddle() {
			const step = 5; // Speed of paddle movement
			if (keys["ArrowUp"]) {
				userPaddle.y = Math.max(userPaddle.y - step, 0);
			}
			if (keys["ArrowDown"]) {
				userPaddle.y = Math.min(userPaddle.y + step, canvas.height - userPaddle.height);
			}
		}

		function update() {
			draw();
			move();
			movePaddle(); // Smooth paddle movement
			requestAnimationFrame(update);
		}

		update();

	</script>
</body>

</html>